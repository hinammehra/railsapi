<%= title "Create Lead"%>
<h3>Create Lead</h3>
<br/>
<div class="row">
  <div class="col-md-8">
    <%= form_for @customer_lead, url: {action: "create_leads_handler"}, method: "POST", html: {class: "form-group", style: "padding-left: 50px;"} do |f| %>

    <div id="selector" class="btn-group">
      <button type="button" class="btn btn-default <%= 'active' if @customer_lead_button %>" value="customer">Customer Lead</button>
      <button type="button" class="btn btn-default <%= 'active' unless @customer_lead_button %>" value="region">Region Lead</button>
    </div>
    <br/>
    <div class="customer_leads_field">
      <%= f.text_field :actual_name, placeholder: 'Company Name', maxlength: 100 %>
      <br/><br/>
      <%= f.text_field :firstname, placeholder: 'First Name', maxlength: 50 %>
      <%= f.text_field :lastname, placeholder: 'Last Name', maxlength: 50 %>
    </div>
    <br/>
    <%= f.text_field :address, placeholder: 'Address', size: 100 %>
    <br/>
    <div class="customer_leads_field">
      <%= f.text_field :email, placeholder: 'Email', maxlength: 100 %>
      <br/><br/>
      <%= f.text_field :phone, placeholder: 'phone number', maxlength:50 %>
      <br/>
    </div>

    <div class="region_leads_field">
      <br/>
      <%= f.text_field :region, placeholder: 'Region', size: 50 %>
      <br/>
    </div>

      <%= f.label :staff, class: 'margin-from-top label-new' %>
      <%= f.collection_select :staff_id, Staff.active_sales_staff, :id, :nickname, {selected: @customer_lead.staff_id}%>

      <%= f.label :channel, class: 'margin-from-top label-new' %>
      <%= f.collection_select :cust_style_id, CustStyle.all, :id, :name, {selected: @customer_lead.cust_style_id, :include_blank => 'Not Assigned'}%><br/>

    <div class="customer_leads_field">
      <%= f.label :type, class: 'margin-from-top label-new' %>
      <%= f.collection_select :cust_type_id, CustType.all, :id, :name, {selected: @customer_lead.cust_type_id, :include_blank => 'Not Assigned'} %>

      <%= f.label :group, class: 'margin-from-top label-new' %>
      <%= f.collection_select :cust_group_id, CustGroup.all, :id, :name, {selected: @customer_lead.cust_group_id, :include_blank => 'Not Assigned'} %><br/>
    </div>
      <%= f.submit "Create!", class: 'btn btn-primary' %>
    <% end %>
  </div>
  <div class="col-md-4 customer_leads_field">
    <% unless @google_client.nil? %>
      <% unless @google_client.photos.blank? %>
        <% url = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" + @google_client.photos.first.photo_reference + "&key=AIzaSyBvfTZH0XCVEJQTgR9QDYt18XIeV5MIkPI"%>
        <%= image_tag "#{url}"%>
      <% end %>
    <!-- map -->
    <script src="//maps.google.com/maps/api/js?key=AIzaSyB1HFWQ1DigWTnXGn_ZaUOk-v8hgGF3moI"></script>
    <script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
    <div style='width: 400px;'>
      <div id="map" style='width: 400px; height: 400px;'></div>
    </div>
    <% end %>
  </div>
</div>


<p style="padding-left: 50px;"><%= link_to "Go Back to Customer Profile", action: 'summary', customer_id: @customer_id, customer_name: @customer_name %></p>

<!-- On-Off button for customer/region -->
<script>
if ($('#selector button.active').val() == "customer") {
  $(".customer_leads_field").show();
  $(".region_leads_field").hide();
} else {
  $(".region_leads_field").show();
  $(".customer_leads_field").hide();
};

$('#selector button').click(function () {
  $(this).addClass('active').siblings().removeClass('active');

  if ($(this).val() == "customer") {
    $(".customer_leads_field").show();
    $(".region_leads_field").hide();
  } else {
    $(".region_leads_field").show();
    $(".customer_leads_field").hide();
  };
});
</script>
<!-- Google Map -->
<script>
<% unless @google_client.nil? %>
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers([
      {
        "lat": '<%= @google_client.lat %>',
        "lng": '<%= @google_client.lng %>',
        "picture": {
          "url": '<%= @google_client.icon%>',
          "width":  50,
          "height": 50
        }
      }
    ]);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(15);
  });
<% end %>
</script>
