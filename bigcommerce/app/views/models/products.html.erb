<h3><center>Products</center></h3>
<div class="form-group container-fluid">
<%= form_tag({:action => "products"}, {:method => "get"}) do %>
	<div class="col-xs-3 col-xs-offset-2">
   <%= text_field_tag('search', @search_text, placeholder: 'Search for Product Name', class: 'form-control') %>
   </div>
   <div class="col-xs-2">
       <%= collection_select(:producer_country, :id, @countries, :id, :name, {:include_blank => 'All Countries'}, {:class => 'form-control'}) %>
   </div>   
   <div class="col-xs-2">
       <%= collection_select(:product_sub_type, :id, @sub_types, :id, :name, {:include_blank => 'All Varietals'}, {:class => 'form-control'}) %>
   </div>
   <%= submit_tag "Filter", class: 'btn btn-primary' %>
   <button class = "btn btn-primary"><%= link_to "Reset", action: "products" %></button>
<% end %>
</div>
<table class = "table table-striped table-bordered table-hover table-responsive">
	<tr>
		<th>Product Name</th>
		<th>Price ( Ex GST )</th>
		<th>Stock</th>
		<th>Pending Stock</th>
		<th>Total Stock</th>
	</tr>

	<% @products.each do |p| %>

		<tr>

			<td><%= link_to p.name, controller: 'sales', action: 'view_customer_stats_for_product', product_id: p.id, product_name: p.name %></td>
			<td class="num"><%= number_with_delimiter(number_with_precision(calculate_product_price(p.calculated_price, p.retail_ws), precision: 2)) %></td>
			<td class="num"><%= p.inventory %></td>
			<td class="num"><%= link_to @pending_stock = return_pending_stock(@product_pending_count, p.id), controller: "sales", action: "view_orders_for_product_and_status", product_id: p.id, product_name: p.name, status_id: 1, status_name: "Pending", num_orders: nil, qty: p.inventory, status_qty: @pending_stock, total: nil %></td>
			<td class="num"><%= @pending_stock + p.inventory %></td>
		</tr>

	<% end %>

</table>

<span style="float:right;margin-right:50px;font-size: 115%;"><%= will_paginate @products %></span>
